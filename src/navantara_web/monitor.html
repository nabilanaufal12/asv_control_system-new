<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NAVANTARA - ASV Dashboard</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;800&family=Inter:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      .trajectory-map {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .trajectory-left, .trajectory-right {
        flex: 1;
        min-width: 350px;
      }
      .trajectory-right {
        background-color: #f0f0f0;
        border: 2px solid #ccc;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 20px;
        min-height: 500px;
      }
      .trajectory-right h4 {
        color: #777;
      }
      .trajectory-right .map-container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .trajectory-right .map-iframe {
        width: 100%;
        height: 450px;
        border: 0;
        border-radius: 8px;
      }
      .trajectory-left .container {
          background-color: white;
          border-radius: 15px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
          padding: 25px;
          text-align: center;
          width: 100%;
          box-sizing: border-box;
      }
      .trajectory-left h1 {
          color: #2c3e50;
          margin-bottom: 15px;
      }
      .trajectory-left .arena-selector {
          margin-bottom: 15px;
      }
      .trajectory-left .arena-selector button {
          background: linear-gradient(to bottom, #9b59b6, #8e44ad);
          color: white;
          border: none;
          padding: 10px 20px;
          font-size: 16px;
          font-weight: bold;
          cursor: pointer;
          border-radius: 50px;
          transition: all 0.3s;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
          margin: 0 10px;
      }
      .trajectory-left .arena-selector button.active {
          background: linear-gradient(to bottom, #2ecc71, #27ae60);
          transform: scale(1.1);
      }
      .trajectory-left #canvas-container {
          position: relative;
          margin: 20px auto;
          width: 100%;
          padding-top: 62.5%;
          border: 2px solid #bdc3c7;
          border-radius: 8px;
          overflow: hidden;
          background-color: white;
      }
      .trajectory-left canvas {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
      }
      .trajectory-left #background-canvas { z-index: 1; }
      .trajectory-left #grid-canvas { z-index: 2; }
      .trajectory-left #line-canvas { z-index: 3; }
      .trajectory-left #point-canvas { z-index: 4; }
      .trajectory-left .button-container {
          margin-top: 20px;
      }
      .trajectory-left #next-btn {
          background: linear-gradient(to bottom, #f39c12, #e67e22);
          color: white;
          border: none;
          padding: 12px 35px;
          font-size: 18px;
          font-weight: bold;
          cursor: pointer;
          border-radius: 50px;
          transition: all 0.3s;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      .trajectory-left #next-btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      }
      .trajectory-left #next-btn:disabled {
          background: linear-gradient(to bottom, #bdc3c7, #95a5a6);
          cursor: not-allowed;
          transform: none;
      }
    </style>
  </head>
  <body>
    <div class="dashboard">
      <header class="header">
        <div class="header-title">
          <h1>NAVANTARA</h1>
          <h2>Universitas Maritim Raja Ali Haji</h2>
        </div>
        <div class="header-logos">
          <img
            src="images/logo-kompetisi.png"
            alt="Competition Logo"
            class="logo"
          />
          <img src="images/logo-kki.png" alt="KKI Logo" class="logo" />
          <img src="images/umm-logo.png" alt="UMM Logo" class="logo" />
        </div>
      </header>

      <main class="main-content">
        <div class="left-column">
          <section class="trajectory-section">
            <div class="section-header">
              <h3>TRAJECTORY</h3>
              <div class="auto-mode">
                <span>A</span>
                <div class="auto-indicator"></div>
              </div>
              <h3 class="path-title">LINTASAN :</h3>
            </div>
            <div class="trajectory-map">
              <div class="trajectory-left">
                <div class="container">
                    <div class="arena-selector">
                        <button id="arena-a-btn">Arena A</button>
                        <button id="arena-b-btn">Arena B</button>
                    </div>
                    
                    <div id="canvas-container">
                        <canvas id="background-canvas" width="800" height="500"></canvas>
                        <canvas id="grid-canvas" width="800" height="500"></canvas>
                        <canvas id="line-canvas" width="800" height="500"></canvas>
                        <canvas id="point-canvas" width="800" height="500"></canvas>
                    </div>
                    
                    <div class="button-container">
                        <button id="next-btn">Next</button>
                    </div>
                </div>
              </div>
              <div class="trajectory-right">
                <div class="map-container">
                    <iframe
                      class="map-iframe"
                      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3951.7259169430485!2d112.60742191428236!3d-7.940212781428385!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e788226002f2b31%3A0xcf610a30b4279093!2sUniversitas%20Muhammadiyah%20Malang%20Campus%203!5e0!3m2!1sid!2sid!4v1628169123456!5m2!1sid!2sid"
                      allowfullscreen=""
                      loading="lazy"
                    ></iframe>
                    <h4>Peta Universitas Muhammadiyah Malang</h4>
                    <p>Kampus 3: Jl. Raya Tlogomas No. 246, Malang</p>
                </div>
              </div>
            </div>
          </section>

          <section class="camera-section">
            <div class="camera-feed">
              <h3>CAM 1</h3>
              <div class="camera-container" id="cam1-container"></div>
            </div>
            <div class="camera-feed">
              <h3>CAM 2</h3>
              <div class="camera-container" id="cam2-container"></div>
            </div>
          </section>
        </div>

        <div class="right-column">
          <section class="info-section">
            <h3>Voyage Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <span>HDG:</span><span id="hdg-value">0°</span>
              </div>
              <div class="info-item">
                <span>SOG:</span><span id="sog-value">0 m/s</span>
              </div>
              <div class="info-item">
                <span>COG:</span><span id="cog-value">0°</span>
              </div>
              <div class="info-item">
                <span>DAY:</span><span id="day-value">...</span>
              </div>
              <div class="info-item">
                <span>DATE:</span><span id="date-value">...</span>
              </div>
              <div class="info-item">
                <span>GPS:</span><span id="gps-value">...</span>
              </div>
            </div>
          </section>

          <section class="capture-section">
            <h3>Hasil Capture</h3>
            <div class="capture-tabs">
              <button class="tab-button active" data-tab="surface">
                Surface
              </button>
              <button class="tab-button" data-tab="underwater">
                Underwater
              </button>
            </div>
            <div class="capture-results">
              <div class="wave-container">
                <div class="wave"></div>
                <div class="wave"></div>
              </div>
              <div class="capture-grid" id="surface-captures"></div>
              <div class="capture-grid hidden" id="underwater-captures"></div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div class="modal" id="image-modal">
      <div class="modal-content">
        <img id="modal-img" src="" alt="Preview Image" />
        <div class="modal-actions">
          <a id="download-btn" href="" download
            ><button class="btn">Download</button></a
          >
          <button id="close-modal" class="btn btn-secondary">Tutup</button>
        </div>
      </div>
    </div>

    <script src="js/firebase.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const backgroundCtx = document.getElementById('background-canvas').getContext('2d');
            const gridCtx = document.getElementById('grid-canvas').getContext('2d');
            const lineCtx = document.getElementById('line-canvas').getContext('2d');
            const pointCtx = document.getElementById('point-canvas').getContext('2d');
            
            const nextBtn = document.getElementById('next-btn');
            const arenaABtn = document.getElementById('arena-a-btn');
            const arenaBBtn = document.getElementById('arena-b-btn');
            
            
            const pointsData = {
                A: [
                    {x: 680, y: 448}, {x: 632, y: 251}, {x: 692, y: 90},
                    {x: 400, y: 90}, {x: 177, y: 92}, {x: 140, y: 256},
                    {x: 167, y: 431}, {x: 312, y: 407}, {x: 628, y: 450}
                ],
                B: [
                    {x: 115, y: 449}, {x: 165, y: 252}, {x: 120, y: 94},
                    {x: 408, y: 91}, {x: 650, y: 86}, {x: 659, y: 251},
                    {x: 617, y: 425}, {x: 480, y: 409}, {x: 156, y: 451}
                ]
            };
            
            let currentArena = 'A';
            let predefinedPoints = pointsData.A;
            let points = [];
            let maxPoints = predefinedPoints.length;
            let currentPointIndex = 0;

            function switchArena(arena) {
                currentArena = arena;
                predefinedPoints = pointsData[arena];
                
                if (arena === 'A') {
                    arenaABtn.classList.add('active');
                    arenaBBtn.classList.remove('active');
                } else {
                    arenaBBtn.classList.add('active');
                    arenaABtn.classList.remove('active');
                }
                
                initialize();
            }
            
            arenaABtn.addEventListener('click', () => switchArena('A'));
            arenaBBtn.addEventListener('click', () => switchArena('B'));
            
            function initialize() {
                drawBackground();
                drawGrid();
                
                points = [];
                currentPointIndex = 0;
                
                
                lineCtx.clearRect(0, 0, 800, 500);
                pointCtx.clearRect(0, 0, 800, 500);
                
                nextBtn.disabled = false;
            }
            
            function drawBackground() {
                backgroundCtx.clearRect(0, 0, 800, 500);
                backgroundCtx.fillStyle = '#FFFFFF';
                backgroundCtx.fillRect(0, 0, 800, 500);
                
                const img = new Image();
                img.onload = () => backgroundCtx.drawImage(img, 0, 0, 800, 500);
                img.onerror = () => {
                    backgroundCtx.fillStyle = '#f0f8ff';
                    backgroundCtx.fillRect(0, 0, 800, 500);
                    backgroundCtx.fillStyle = '#3498db';
                    backgroundCtx.font = 'bold 24px Arial';
                    backgroundCtx.textAlign = 'center';
                    backgroundCtx.fillText(`ARENA ${currentArena}`, 400, 250);
                };
                img.src = `Arena_${currentArena}.png`;
            }

            function drawGrid() {
                gridCtx.clearRect(0, 0, 800, 500);
                gridCtx.strokeStyle = '#e0e0e0';
                gridCtx.lineWidth = 1;
                for (let x = 50; x < 800; x += 50) {
                    gridCtx.beginPath(); gridCtx.moveTo(x, 0); gridCtx.lineTo(x, 500); gridCtx.stroke();
                }
                for (let y = 50; y < 500; y += 50) {
                    gridCtx.beginPath(); gridCtx.moveTo(0, y); gridCtx.lineTo(800, y); gridCtx.stroke();
                }
                gridCtx.strokeStyle = '#bdc3c7';
                gridCtx.lineWidth = 2;
                gridCtx.strokeRect(0, 0, 800, 500);
            }

            function drawPoint(x, y, index) {
                pointCtx.fillStyle = '#8e44ad';
                pointCtx.beginPath();
                pointCtx.arc(x, y, 8, 0, Math.PI * 2);
                pointCtx.fill();
                pointCtx.strokeStyle = '#ffffff';
                pointCtx.lineWidth = 2;
                pointCtx.stroke();
                
                pointCtx.fillStyle = '#2c3e50';
                pointCtx.font = 'bold 16px Arial';
                pointCtx.textAlign = 'center';
                pointCtx.fillText((index + 1).toString(), x, y - 25);
            }

            function drawLine(x1, y1, x2, y2) {
                lineCtx.strokeStyle = '#FFA500';
                lineCtx.lineWidth = 3;
                lineCtx.setLineDash([10, 5]);
                lineCtx.beginPath();
                lineCtx.moveTo(x1, y1);
                lineCtx.lineTo(x2, y2);
                lineCtx.stroke();
                lineCtx.setLineDash([]);
            }

            function drawAll() {
                lineCtx.clearRect(0, 0, 800, 500);
                pointCtx.clearRect(0, 0, 800, 500);
                for (let i = 0; i < points.length; i++) {
                    drawPoint(points[i].x, points[i].y, i);
                    if (i > 0) {
                        drawLine(points[i-1].x, points[i-1].y, points[i].x, points[i].y);
                    }
                }
            }
            
            nextBtn.addEventListener('click', function() {
                if (currentPointIndex >= maxPoints) return;
                
                points.push(predefinedPoints[currentPointIndex]);
                currentPointIndex++;
                
                drawAll();
                
                if (points.length === maxPoints) {
                    nextBtn.disabled = true;
                }
            });
            
            switchArena('A');
        });
    </script>
  </body>
</html>